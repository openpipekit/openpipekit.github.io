window.OpkBakery={Models:{},Collections:{},Views:{},Routers:{},init:function(){"use strict";"localhost:9000"===window.location.host?OpkBakery.host="http://live-open-pipe-kit-packages.pantheon.io/":OpkBakery.host="http://live-open-pipe-kit-packages.pantheon.io/",this.darkify();new OpkBakery.Routers.RecipeBakery;Backbone.history.start()},spinOpts:{lines:13,length:28,width:14,radius:42,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:60,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"},darkify:function(){var a=!1;window.addEventListener("devicelight",function(b){b.value<40&&a===!1?(a=!0,$("body").addClass("dark"),$("head").append('<link id="dark-theme" rel="stylesheet" href="styles/bootstrap-cyborg.min.css">')):b.value>40&&a===!0&&(a=!1,$("body").removeClass("dark"),$("#dark-theme").remove()),console.log(b.value)})}},$(document).ready(function(){"use strict";OpkBakery.init()}),this.JST=this.JST||{},this.JST["app/scripts/templates/ConfigurePackage.ejs"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+="<p>Your content here.</p>\n\n";return __p},this.JST["app/scripts/templates/ConfigureWifi.ejs"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+="<p>Your content here.</p>\n\n";return __p},this.JST["app/scripts/templates/GetTheKit.ejs"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='\n<h2> Build a kit </h2>\n<p>\n  <a href="https://opk.hackpad.com/Build-an-Open-Pipe-Kit.txt-2OB5VTh3pkZ">Click here for the Open Pipe Kit wiki that has documentation on how to build your own kit.</a>\n</p>\n\n<h2> Have a kit sent to your doorstep </h2>\n<p>\n  Need help? We\'d be glad to help. Send R.J. an email at rj@rjsteinert.com\n</p>\n\n<h2> Next step </h2>\n<p>\n  Click on <a href="#configure">configure (see above)</a> where you\'ll select your sensor and database (it could just be an Excel file on your USB Drive), save the resulting file to your USB Drive, plug it all in. When the green light flashes a heartbeat, your Raspberry Pi is piping data.\n</p>\n';return __p},this.JST["app/scripts/templates/Home.ejs"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='\n<h1 class="home-header" style="text-align: center;">Be everywhere.</h2>\n<h2 class="home-header" style="text-align: center;">A Pipe sends sensor data to you. </h2>\n';return __p},this.JST["app/scripts/templates/HowOften.ejs"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+="<p>Your content here.</p>\n\n";return __p},this.JST["app/scripts/templates/Intro.ejs"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div class="jumbotron">\n  <h1>Let\'s bake a pipe for you.</h1>\n  <p>This app will ask a couple of questions leading you through the process of creating a pipe on a USB Drive. This software is just a prototype so if you hit any glitches, do <a href="https://groups.google.com/forum/#!forum/open-pipe-kit" alt="contact us about glitches">let us know</a>.</p>\n  <p><a class="btn btn-primary btn-lg" href="#which-sensor" role="button">Begin</a></p>\n</div>\n';return __p},this.JST["app/scripts/templates/PackageRow.ejs"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+="<td>\n	",""!==thumbnail&&(__p+="\n		<img src='"+(null==(__t=thumbnail)?"":__t)+"'>\n	"),__p+="\n<td>\n	"+(null==(__t=title)?"":__t)+"\n</td>\n<td>\n	"+(null==(__t=field_package_description)?"":__t)+"\n</td>\n<td>\n	<button class='btn btn-primary'>Select</button>\n</td>\n";return __p},this.JST["app/scripts/templates/PackageRowSimple.ejs"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<td class="package-row-simple--thumbnail">\n	',""!==thumbnail&&(__p+="\n		<img src='"+(null==(__t=thumbnail)?"":__t)+"'>\n	"),__p+='\n<td class="package-row-simple--title">\n	'+(null==(__t=title)?"":__t)+"\n</td>\n";return __p},this.JST["app/scripts/templates/PackageTableSimple.ejs"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+="\n";return __p},this.JST["app/scripts/templates/PackagesTable.ejs"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+="<h1> Which Sensor?</h2>\n\n";return __p},this.JST["app/scripts/templates/PlugItIn.ejs"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+="<h1>You rock! Ready to plug it in?</h1>\n<p>\n  Now that you have your Pipe configured, it's time to plug it all in and start collecting data. We're building functionality to help you out with this. Cool stuff like blinking lights on your pipe and things like that. We're also working on a guide, but you know what? We need your help building this guide. Contact R.J. (rj@rjsteinert.com) to be a member of our beta tester program and we'll have your back. Hope to see you soon!\n</p>\n";return __p},this.JST["app/scripts/templates/Recipe.ejs"]=function(obj){obj||(obj={});var __t,__p="";_.escape;with(obj)__p+='<p>Place this in a file named autorunonce.sh on a USB Drive and then plug everything into your Raspberry Pi.</p>\n<textarea class="form-control" rows="10">\n'+(null==(__t=script)?"":__t)+"\n</textarea>\n\n";return __p},this.JST["app/scripts/templates/SensorSimple.ejs"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+="<td>\n	",""!==thumbnail&&(__p+="\n		<img src='"+(null==(__t=thumbnail)?"":__t)+"'>\n	"),__p+="\n<td>\n	"+(null==(__t=title)?"":__t)+"\n</td>\n<td>\n	"+(null==(__t=field_package_description)?"":__t)+"\n</td>\n";return __p},this.JST["app/scripts/templates/SensorsSimple.ejs"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+="\n";return __p},OpkBakery.Models=OpkBakery.Models||{},function(){"use strict";OpkBakery.Models.Wifi=Backbone.Model.extend({url:"",initialize:function(){},defaults:{},validate:function(a,b){},parse:function(a,b){return a}})}(),OpkBakery.Models=OpkBakery.Models||{},function(){"use strict";OpkBakery.Models.Package=Backbone.Model.extend({idAttribute:"nid",url:function(){return OpkBakery.host+"/api/package/"+this.id},defaults:{},initialize:function(){this.commands=[]},validate:function(a,b){},parse:function(a,b){var c=this;c.commands=[];var d=JSON.parse(a.field_package_json);return d.forEach(function(b){var d=new OpkBakery.Models.Cli;d.set("package",a.field_package_name),d.set("command",b.command),d.schema=b.options,c.commands.push(d)}),a},generateInstall:function(){var a="wget  -O "+this.get("field_package_name")+".tar.gz "+this.get("field_package_download_url")+"\n";return a+="mkdir "+this.get("field_package_name")+"\n",a+="tar xzf "+this.get("field_package_name")+".tar.gz --strip-components=1 -C "+this.get("field_package_name")+"\n",a+="cd "+this.get("field_package_name")+" \n",a+="if [ -f ./install ]; then ",a+="./install;",a+="fi\n",a+="cd .. \n"}})}(),OpkBakery.Collections=OpkBakery.Collections||{},function(){"use strict";OpkBakery.Collections.Packages=Backbone.Collection.extend({initialize:function(){this.params={packageType:""}},model:OpkBakery.Models.Package,url:function(){return OpkBakery.host+"/api/package/"+this.params.packageType}})}(),OpkBakery.Views=OpkBakery.Views||{},function(){"use strict";OpkBakery.Views.PackageRow=Backbone.View.extend({template:JST["app/scripts/templates/PackageRow.ejs"],tagName:"tr",id:"",className:"",events:{"click button":"select"},initialize:function(){this.listenTo(this.model,"change",this.render)},render:function(){this.$el.attr("data-id",this.model.id),this.$el.html(this.template(this.model.toJSON()))},select:function(){this.$el.addClass("selected"),this.$el.parent().trigger("select")}})}(),OpkBakery.Views=OpkBakery.Views||{},function(){"use strict";OpkBakery.Views.PackagesTable=Backbone.View.extend({itemView:"PackageRow",template:JST["app/scripts/templates/SensorsTable.ejs"],tagName:"table",id:"",className:"table",events:{},initialize:function(){this.$el.spin(OpkBakery.spinOpts),this.listenTo(this.collection,"change",this.render),this.listenTo(this.collection,"sync",this.render)},render:function(){this.$el.fadeOut();var a=this;setTimeout(function(){a.$el.spin(!1),a.collection.models.forEach(function(a){var b=new OpkBakery.Views[this.itemView]({model:a});this.$el.append(b.el),b.render()},a),a.$el.fadeIn()},500)}})}(),OpkBakery.Routers=OpkBakery.Routers||{},function(){"use strict";OpkBakery.Routers.RecipeBakery=Backbone.Router.extend({initialize:function(){OpkBakery.recipe=new OpkBakery.Models.Recipe},routes:{"":"home","which-sensor":"whichSensor",configure:"whichSensor","configure-sensor":"configureSensor","which-database":"whichDatabase","configure-database":"configureDatabase","how-often":"howOften","configure-wifi":"configureWifi",recipe:"recipe","get-the-kit":"getTheKit","plug-it-in":"plugItIn"},home:function(){$(".main").fadeOut(),setTimeout(function(){$("body").addClass("plug-it-in"),$(".main").html("");var a=new OpkBakery.Views.Home;$(".main").append(a.el),a.render(),$(".main").fadeIn();var b=new OpkBakery.Collections.Packages;b.params.packageType="sensors";var c=new OpkBakery.Views.PackageTableSimple({collection:b});$(".main").append('<h2 style="font-weight: lighter; text-align: center; padding: 420px 0 30px 0;">Connect your pipe to any of these sensors.</h2>'),$(".main").append(c.el),b.fetch();var d=new OpkBakery.Collections.Packages;d.params.packageType="databases";var e=new OpkBakery.Views.PackageTableSimple({collection:d});$(".main").append('<h2 style="font-weight: lighter; text-align: center; padding: 30px 0 30px 0;">Send your data to any of these places.</h2>'),$(".main").append(e.el),d.fetch(),$(".main").append("<h2>Are you a developer interested in Open Pipe Kit?"),$(".main").append('Check out our <a href="http://opk.hackpad.com/Open-Pipe-Kit-Documentation.txt-IUttZt9F0jp">Hackpad Wiki</a> and chime in on our <a href="https://groups.google.com/forum/#!forum/open-pipe-kit">listserv</a>.')},500)},getTheKit:function(){$("body").removeClass("plug-it-in"),$(".main").fadeOut(),setTimeout(function(){$(".main").html("");var a=new OpkBakery.Views.GetTheKit;$(".main").append(a.el),a.render(),$(".main").fadeIn()},500)},plugItIn:function(){$("body").removeClass("plug-it-in"),$(".main").fadeOut(),setTimeout(function(){$(".main").html("");var a=new OpkBakery.Views.PlugItIn;$(".main").append(a.el),a.render(),$(".main").fadeIn()},500)},intro:function(){$(".main").html();var a=new OpkBakery.Views.Intro;$(".main").append(a.el),a.render()},whichSensor:function(){$("body").removeClass("plug-it-in"),$(".main").html("<h1>Which sensor?</h1>");var a=new OpkBakery.Collections.Packages;a.params.packageType="sensors";var b=new OpkBakery.Views.PackagesTable({collection:a});$(".main").append(b.el),b.$el.on("select",function(){var c=b.$el.find(".selected")[0],d=$(c).attr("data-id");a.models.forEach(function(a){a.id==d&&OpkBakery.recipe.set("sensorPackage",a)}),Backbone.history.navigate("configure-sensor",{trigger:!0})}),a.fetch()},configureSensor:function(){$(".main").html("<h1>Configure your sensor</h1>");var a=new OpkBakery.Models.Package({nid:OpkBakery.recipe.get("sensorPackage").id}),b=new OpkBakery.Views.ConfigurePackage({model:a});$(".main").append(b.el),a.fetch(),b.on("configured",function(){console.log("ok"),OpkBakery.recipe.set("sensorCli",this.cli),Backbone.history.navigate("which-database",{trigger:!0})})},whichDatabase:function(){$(".main").html("<h1>Which database?</h1>");var a=new OpkBakery.Collections.Packages;a.params.packageType="databases";var b=new OpkBakery.Views.PackagesTable({collection:a});$(".main").append(b.el),b.$el.on("select",function(){var c=b.$el.find(".selected")[0],d=$(c).attr("data-id");a.models.forEach(function(a){a.id==d&&OpkBakery.recipe.set("databasePackage",a)}),Backbone.history.navigate("configure-database",{trigger:!0})}),a.fetch()},configureDatabase:function(){$(".main").html("<h1>Configure your database</h1>");var a=new OpkBakery.Models.Package({nid:OpkBakery.recipe.get("databasePackage").id}),b=new OpkBakery.Views.ConfigurePackage({model:a});$(".main").append(b.el),a.fetch(),b.on("configured",function(){console.log("ok"),OpkBakery.recipe.set("databaseCli",this.cli),Backbone.history.navigate("how-often",{trigger:!0})})},howOften:function(){$(".main").html("<h1>How often?</h1>");var a=new OpkBakery.Models.Watch,b=new OpkBakery.Views.HowOften({model:a});$(".main").append(b.el),b.on("submit",function(){OpkBakery.recipe.set("interval",a.get("interval")),Backbone.history.navigate("configure-wifi",{trigger:!0})}),b.render()},configureWifi:function(){$(".main").html("<h1>Configure WiFi</h1>");var a=new OpkBakery.Models.WifiOptions,b=new OpkBakery.Views.ConfigureWifi({model:a});$(".main").append(b.el),b.on("configured",function(){OpkBakery.recipe.set("wifiName",this.model.get("wifiName")),OpkBakery.recipe.set("wifiPassword",this.model.get("wifiPassword")),Backbone.history.navigate("recipe",{trigger:!0})}),b.render()},recipe:function(){var a=new OpkBakery.Views.Recipe({model:OpkBakery.recipe});$(".main").html(a.el),a.render()}})}(),OpkBakery.Models=OpkBakery.Models||{},function(){"use strict";OpkBakery.Models.Recipe=Backbone.Model.extend({url:"",initialize:function(){},defaults:{},validate:function(a,b){},parse:function(a,b){return a}})}(),OpkBakery.Views=OpkBakery.Views||{},function(){"use strict";OpkBakery.Views.ConfigurePackage=Backbone.View.extend({template:JST["app/scripts/templates/ConfigurePackage.ejs"],tagName:"div",id:"",className:"",events:{},initialize:function(){this.$el.spin(OpkBakery.spinOpts),this.listenTo(this.model,"sync",this.render)},render:function(){this.$el.spin(!1);var a=this,b=this.model.commands[0];if(this.cli=b,0==Object.keys(b.schema).length)a.trigger("configured");else{var c=new Backbone.Form({model:b,submitButton:"submit"}).render();c.$el.append('<button class="btn btn-default">submit</button>'),this.$el.html(c.el),$(this.$el.find("button")[0]).on("click",function(b){b.preventDefault(),console.log("submitted"),c.commit(),a.trigger("configured")})}}})}(),OpkBakery.Models=OpkBakery.Models||{},function(){"use strict";OpkBakery.Models.Cli=Backbone.Model.extend({url:"",initialize:function(){},defaults:{},validate:function(a,b){},parse:function(a,b){return a},generateCommand:function(){var a="./"+this.get("package")+"/"+this.get("command")+" ";return _.each(this.toJSON(),function(b,c){"package"!==c&&"command"!==c&&("boolean"==typeof b?1==b&&(a+=" --"+c):a+=" --"+c+" "+b)}),a}})}(),OpkBakery.Views=OpkBakery.Views||{},function(){"use strict";OpkBakery.Views.Recipe=Backbone.View.extend({template:JST["app/scripts/templates/Recipe.ejs"],tagName:"div",id:"",className:"",events:{},initialize:function(){this.listenTo(this.model,"change",this.render)},render:function(){var a=this.model.toJSON();a.script=this.generateScript(),this.$el.html(this.template(a)),this.$el.append("<p>"),this.$el.append(this.generateDownload()),this.$el.append("</p>")},generateScript:function(){var a=this.model.get("sensorCli"),b=this.model.get("sensorPackage"),c=this.model.get("databaseCli"),d=this.model.get("databasePackage"),e="#!/bin/bash \n";return e+="pirateship wifi "+this.model.get("wifiName")+" "+this.model.get("wifiPassword")+" \n",e+=b.generateInstall()+" \n",e+=d.generateInstall()+" \n",e+="touch autorun.sh \n",e+="echo '#!/bin/bash' >> autorun.sh \n",e+="echo 'if [ -f ./"+d.get("field_package_name")+"/onboot.sh ]; then ./"+d.get("field_package_name")+"/onboot;fi' >> autorun.sh \n",e+="echo 'if [ -f ./"+b.get("field_package_name")+"/onboot.sh ]; then ./"+b.get("field_package_name")+"/onboot;fi' >> autorun.sh \n",e+="echo 'watch -n"+this.model.get("interval")+' "',e+=a.generateCommand(),e+=" | tee -a log.txt | ",e+=c.generateCommand(),e+=" | tee -a log.txt\"' >> autorun.sh"},generateDownload:function(){var a="autorunonce.sh",b=$(this.$el.find("textarea")[0]).text(),c=document.createElement("a");return c.className="btn btn-success",c.download=a,c.textContent="download",c.href="data:application/json;base64,"+window.btoa(unescape(encodeURIComponent(b))),c}})}(),OpkBakery.Views=OpkBakery.Views||{},function(){"use strict";OpkBakery.Views.HowOften=Backbone.View.extend({template:JST["app/scripts/templates/HowOften.ejs"],tagName:"div",id:"",className:"",events:{},initialize:function(){this.listenTo(this.model,"change",this.render)},render:function(){var a=this,b=new Backbone.Form({model:this.model,submitButton:"submit"}).render();b.$el.append('<button class="btn btn-default">submit</button>'),this.$el.html(b.el),$(this.$el.find("button")[0]).on("click",function(c){c.preventDefault(),console.log("submitted"),b.commit(),a.trigger("submit")})}})}(),OpkBakery.Models=OpkBakery.Models||{},function(){"use strict";OpkBakery.Models.Watch=Backbone.Model.extend({url:"",initialize:function(){},defaults:{},validate:function(a,b){},parse:function(a,b){return a},schema:{interval:{type:"Text",title:"(in seconds)"}}})}(),OpkBakery.Views=OpkBakery.Views||{},function(){"use strict";OpkBakery.Views.Intro=Backbone.View.extend({template:JST["app/scripts/templates/Intro.ejs"],tagName:"div",id:"",className:"",events:{},initialize:function(){},render:function(){this.$el.html(this.template())}})}(),OpkBakery.Models=OpkBakery.Models||{},function(){"use strict";OpkBakery.Models.WifiOptions=Backbone.Model.extend({url:"",initialize:function(){},defaults:{},validate:function(a,b){},parse:function(a,b){return a},schema:{wifiName:"Text",wifiPassword:"Text"}})}(),OpkBakery.Views=OpkBakery.Views||{},function(){"use strict";OpkBakery.Views.ConfigureWifi=Backbone.View.extend({template:JST["app/scripts/templates/ConfigureWifi.ejs"],tagName:"div",id:"",className:"",events:{},initialize:function(){this.listenTo(this.model,"change",this.render)},render:function(){var a=this,b=new Backbone.Form({model:this.model,submitButton:"submit"}).render();b.$el.append('<button class="btn btn-default">submit</button>'),this.$el.html(b.el),$(this.$el.find("button")[0]).on("click",function(c){c.preventDefault(),console.log("submitted"),b.commit(),a.trigger("configured")})}})}(),OpkBakery.Views=OpkBakery.Views||{},function(){"use strict";OpkBakery.Views.Home=Backbone.View.extend({template:JST["app/scripts/templates/Home.ejs"],tagName:"div",id:"",className:"",events:{},initialize:function(){},render:function(){this.$el.html(this.template())}})}(),OpkBakery.Views=OpkBakery.Views||{},function(){"use strict";OpkBakery.Views.SensorsSimple=Backbone.View.extend({itemView:"SensorSimple",template:JST["app/scripts/templates/SensorsSimple.ejs"],tagName:"div",id:"",className:"",events:{},initialize:function(){this.$el.spin(OpkBakery.spinOpts),this.listenTo(this.collection,"change",this.render),this.listenTo(this.collection,"sync",this.render)},render:function(){this.$el.spin(!1),this.collection.models.forEach(function(a){var b=new OpkBakery.Views[this.itemView]({model:a});this.$el.append(b.el),b.render()},this)}})}(),OpkBakery.Views=OpkBakery.Views||{},function(){"use strict";OpkBakery.Views.SensorSimple=Backbone.View.extend({template:JST["app/scripts/templates/SensorSimple.ejs"],tagName:"div",id:"",className:"",events:{},initialize:function(){this.listenTo(this.model,"change",this.render)},render:function(){this.$el.html(this.template(this.model.toJSON()))}})}(),OpkBakery.Views=OpkBakery.Views||{},function(){"use strict";OpkBakery.Views.PackageRowSimple=OpkBakery.Views.PackageRow.extend({template:JST["app/scripts/templates/PackageRowSimple.ejs"]})}(),OpkBakery.Views=OpkBakery.Views||{},function(){"use strict";OpkBakery.Views.PackageTableSimple=OpkBakery.Views.PackagesTable.extend({itemView:"PackageRowSimple",template:JST["app/scripts/templates/PackageTableSimple.ejs"]})}(),OpkBakery.Views=OpkBakery.Views||{},function(){"use strict";OpkBakery.Views.GetTheKit=Backbone.View.extend({template:JST["app/scripts/templates/GetTheKit.ejs"],tagName:"div",id:"",className:"",events:{},initialize:function(){},render:function(){this.$el.html(this.template())}})}(),OpkBakery.Views=OpkBakery.Views||{},function(){"use strict";OpkBakery.Views.PlugItIn=Backbone.View.extend({template:JST["app/scripts/templates/PlugItIn.ejs"],tagName:"div",id:"",className:"",events:{},initialize:function(){},render:function(){this.$el.html(this.template())}})}();