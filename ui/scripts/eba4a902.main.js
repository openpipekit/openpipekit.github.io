window.OpkBakery={Models:{},Collections:{},Views:{},Routers:{},init:function(){"use strict";"localhost:9000"===window.location.host?OpkBakery.host="http://local.opkp.org":OpkBakery.host="http://dev-open-pipe-kit-packages.pantheon.io/";new OpkBakery.Routers.RecipeBakery;Backbone.history.start()}},$(document).ready(function(){"use strict";OpkBakery.init()}),this.JST=this.JST||{},this.JST["app/scripts/templates/ConfigurePackage.ejs"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+="<p>Your content here.</p>\n\n";return __p},this.JST["app/scripts/templates/HowOften.ejs"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+="<p>Your content here.</p>\n\n";return __p},this.JST["app/scripts/templates/PackageRow.ejs"]=function(obj){obj||(obj={});var __t,__p="";_.escape;with(obj)__p+="<td>\n	"+(null==(__t=title)?"":__t)+"\n</td>\n<td>\n	<button class='button'>Select</button>\n</td>";return __p},this.JST["app/scripts/templates/PackagesTable.ejs"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+="<h1> Which Sensor?</h2>\n\n";return __p},this.JST["app/scripts/templates/Recipe.ejs"]=function(obj){obj||(obj={});var __t,__p="";_.escape;with(obj)__p+='<p>Place this in a file named autorunonce.sh on a USB Drive and then plug everything into your Raspberry Pi.</p>\n<textarea class="form-control" rows="10">\n'+(null==(__t=script)?"":__t)+"\n</textarea>\n\n";return __p},OpkBakery.Models=OpkBakery.Models||{},function(){"use strict";OpkBakery.Models.Wifi=Backbone.Model.extend({url:"",initialize:function(){},defaults:{},validate:function(a,b){},parse:function(a,b){return a}})}(),OpkBakery.Models=OpkBakery.Models||{},function(){"use strict";OpkBakery.Models.Package=Backbone.Model.extend({idAttribute:"nid",url:function(){return OpkBakery.host+"/api/package/"+this.id},defaults:{},initialize:function(){this.commands=[]},validate:function(a,b){},parse:function(a,b){var c=this;c.commands=[];var d=JSON.parse(a.field_package_json);return d.forEach(function(b){var d=new OpkBakery.Models.Cli;d.set("package",a.field_package_name),d.set("command",b.command),d.schema=b.options,c.commands.push(d)}),a},generateInstall:function(){var a="wget  --output "+this.get("field_package_name")+" "+this.get("field_package_download_url")+" \n";return a+="unzip "+this.get("field_package_name")+" -d "+this.get("field_package_name")+" \n"}})}(),OpkBakery.Collections=OpkBakery.Collections||{},function(){"use strict";OpkBakery.Collections.Packages=Backbone.Collection.extend({initialize:function(){this.params={packageType:""}},model:OpkBakery.Models.Package,url:function(){return OpkBakery.host+"/api/package/"+this.params.packageType}})}(),OpkBakery.Views=OpkBakery.Views||{},function(){"use strict";OpkBakery.Views.PackageRow=Backbone.View.extend({template:JST["app/scripts/templates/PackageRow.ejs"],tagName:"tr",id:"",className:"",events:{"click button":"select"},initialize:function(){this.listenTo(this.model,"change",this.render)},render:function(){this.$el.attr("data-id",this.model.id),this.$el.html(this.template(this.model.toJSON()))},select:function(){this.$el.addClass("selected"),this.$el.parent().trigger("select")}})}(),OpkBakery.Views=OpkBakery.Views||{},function(){"use strict";OpkBakery.Views.PackagesTable=Backbone.View.extend({itemView:"PackageRow",template:JST["app/scripts/templates/SensorsTable.ejs"],tagName:"table",id:"",className:"",events:{},initialize:function(){this.listenTo(this.collection,"change",this.render),this.listenTo(this.collection,"sync",this.render)},render:function(){this.collection.models.forEach(function(a){var b=new OpkBakery.Views[this.itemView]({model:a});this.$el.append(b.el),b.render()},this)}})}(),OpkBakery.Routers=OpkBakery.Routers||{},function(){"use strict";OpkBakery.Routers.RecipeBakery=Backbone.Router.extend({initialize:function(){OpkBakery.recipe=new OpkBakery.Models.Recipe},routes:{"":"whichSensor","configure-sensor":"configureSensor","which-database":"whichDatabase","configure-database":"configureDatabase","how-often":"howOften",recipe:"recipe"},whichSensor:function(){var a=new OpkBakery.Collections.Packages;a.params.packageType="sensors";var b=new OpkBakery.Views.PackagesTable({collection:a});$(".main").html(b.el),b.$el.on("select",function(){var c=b.$el.find(".selected")[0],d=$(c).attr("data-id");a.models.forEach(function(a){a.id==d&&OpkBakery.recipe.set("sensorPackage",a)}),Backbone.history.navigate("configure-sensor",{trigger:!0})}),a.fetch()},configureSensor:function(){var a=new OpkBakery.Models.Package({nid:OpkBakery.recipe.get("sensorPackage").id}),b=new OpkBakery.Views.ConfigurePackage({model:a});$(".main").html(b.el),a.fetch(),b.on("configured",function(){console.log("ok"),OpkBakery.recipe.set("sensorCli",this.cli),Backbone.history.navigate("which-database",{trigger:!0})})},whichDatabase:function(){var a=new OpkBakery.Collections.Packages;a.params.packageType="databases";var b=new OpkBakery.Views.PackagesTable({collection:a});$(".main").html(b.el),b.$el.on("select",function(){var c=b.$el.find(".selected")[0],d=$(c).attr("data-id");a.models.forEach(function(a){a.id==d&&OpkBakery.recipe.set("databasePackage",a)}),Backbone.history.navigate("configure-database",{trigger:!0})}),a.fetch()},configureDatabase:function(){var a=new OpkBakery.Models.Package({nid:OpkBakery.recipe.get("databasePackage").id}),b=new OpkBakery.Views.ConfigurePackage({model:a});$(".main").html(b.el),a.fetch(),b.on("configured",function(){console.log("ok"),OpkBakery.recipe.set("databaseCli",this.cli),Backbone.history.navigate("how-often",{trigger:!0})})},howOften:function(){var a=new OpkBakery.Models.Watch,b=new OpkBakery.Views.HowOften({model:a});$(".main").html(b.el),b.on("submit",function(){OpkBakery.recipe.set("interval",a.get("interval")),Backbone.history.navigate("recipe",{trigger:!0})}),b.render()},recipe:function(){var a=new OpkBakery.Views.Recipe({model:OpkBakery.recipe});$(".main").html(a.el),a.render()}})}(),OpkBakery.Models=OpkBakery.Models||{},function(){"use strict";OpkBakery.Models.Recipe=Backbone.Model.extend({url:"",initialize:function(){},defaults:{},validate:function(a,b){},parse:function(a,b){return a}})}(),OpkBakery.Views=OpkBakery.Views||{},function(){"use strict";OpkBakery.Views.ConfigurePackage=Backbone.View.extend({template:JST["app/scripts/templates/ConfigurePackage.ejs"],tagName:"div",id:"",className:"",events:{},initialize:function(){this.listenTo(this.model,"sync",this.render)},render:function(){var a=this,b=this.model.commands[0];if(this.cli=b,0==Object.keys(b.schema).length)a.trigger("configured");else{var c=new Backbone.Form({model:b,submitButton:"submit"}).render();this.$el.html(c.el),this.$el.append('<button class="btn">submit</button>'),$(this.$el.find("button")[0]).on("click",function(){console.log("submitted"),c.commit(),a.trigger("configured")})}}})}(),OpkBakery.Models=OpkBakery.Models||{},function(){"use strict";OpkBakery.Models.Cli=Backbone.Model.extend({url:"",initialize:function(){},defaults:{},validate:function(a,b){},parse:function(a,b){return a},generateCommand:function(){var a="./"+this.get("package")+"/"+this.get("command")+" ";return _.each(this.toJSON(),function(b,c){"package"!==c&&"command"!==c&&(a+=" --"+c+" "+b)}),a}})}(),OpkBakery.Views=OpkBakery.Views||{},function(){"use strict";OpkBakery.Views.Recipe=Backbone.View.extend({template:JST["app/scripts/templates/Recipe.ejs"],tagName:"div",id:"",className:"",events:{},initialize:function(){this.listenTo(this.model,"change",this.render)},render:function(){var a=this.model.toJSON();a.script=this.generateScript(),this.$el.html(this.template(a))},generateScript:function(){var a=this.model.get("sensorCli"),b=this.model.get("sensorPackage"),c=this.model.get("databaseCli"),d=this.model.get("databasePackage"),e="#! /bin/bash \n";return e+=b.generateInstall()+" \n",e+=d.generateInstall()+" \n",e+="touch autorun.sh \n",e+='echo "#! /bin/bash" >> autorun.sh \n',e+='echo "watch -n'+this.model.get("interval")+' "',e+=a.generateCommand(),e+=" | ",e+=c.generateCommand(),e+='" >> autorun.sh'}})}(),OpkBakery.Views=OpkBakery.Views||{},function(){"use strict";OpkBakery.Views.HowOften=Backbone.View.extend({template:JST["app/scripts/templates/HowOften.ejs"],tagName:"div",id:"",className:"",events:{},initialize:function(){this.listenTo(this.model,"change",this.render)},render:function(){var a=this,b=new Backbone.Form({model:this.model,submitButton:"submit"}).render();this.$el.html(b.el),this.$el.append('<button class="btn">submit</button>'),$(this.$el.find("button")[0]).on("click",function(){console.log("submitted"),b.commit(),a.trigger("submit")})}})}(),OpkBakery.Models=OpkBakery.Models||{},function(){"use strict";OpkBakery.Models.Watch=Backbone.Model.extend({url:"",initialize:function(){},defaults:{},validate:function(a,b){},parse:function(a,b){return a},schema:{interval:"Text"}})}();